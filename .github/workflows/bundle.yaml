name: Bundle

on:
  push:
    branches:
      - main

jobs:
  bundle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3


      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Run bundle script
        run: node bundle.js

  push:
    needs: bundle
    runs-on: ubuntu-latest

    permissions:
      pages: write
      id-token: write

    steps:
      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v1

      - uses: actions/checkout@v3
      - shell: bash
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git checkout -b dist
          git add -f dist/
          git commit -m "Deploy dist directory"
          git push -f origin dist
