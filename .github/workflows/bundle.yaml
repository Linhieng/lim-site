name: Bundle and Push

on:
  push:
    branches:
      - main
permissions:
  contents: write

jobs:
  bundle:
    permissions:
      pages: write
      id-token: write

    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 21

      - name: Run bundle script
        run: node bundle.js

      - name: Push dist branch
        run: |
          git config user.name linhieng
          git config user.email linhieng@qq.com
          git checkout -b dist
          git add -f dist/
          git commit -m "Deploy dist directory"
          git remote remove origin
          git remote add origin https://github.com/Linhieng/lim-site.git
          git push -f origin dist
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
